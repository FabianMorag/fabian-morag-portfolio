---
import { Image } from 'astro:assets'
import { REFERENCES } from '@/contants/references.js'
---

<section id="references" class="px-4 py-24">
  <div class="m-auto max-w-5xl">
    <h2 class="mb-12 px-6 font-bold text-4xl md:text-5xl text-center">Referencias</h2>

    <div class="relative">
      <div class="hidden-scrollbar flex overflow-x-scroll scroll-smooth snap-mandatory snap-x references-carrousel">
        {
          REFERENCES.map(({ name, image, role, link, rec }) => (
            <div class="p-2 min-w-full md:min-w-1/2 snap-center md:snap-start">
              <article class="p-6 md:p-8 rounded-2xl h-full glass">
                <Image
                  src={image}
                  alt={`Imagen de ${name}`}
                  class="p-1 border-2 border-primary rounded-full object-cover aspect-square"
                  width={80}
                  height={80}
                />

                <a href={link} target="_blank" class="font-semibold text-lg md:text-xl link link-primary">
                  {name}
                </a>
                <small class="block mb-4 text-sm">{role}</small>

                <div class="[&>p:last-child]:mb-0 [&>p]:mb-[.5lh]">
                  {rec.map(paragraph => (
                    <p class="text-sm md:text-base whitespace-pre-line">{paragraph}</p>
                  ))}
                </div>
              </article>
            </div>
          ))
        }
      </div>

      <button
        class="hidden top-1/2 left-1 references-carrousel-left-btn absolute size-8 cursor-pointer btn btn-circle btn-neutral"
        >❮</button
      >
      <button
        class="top-1/2 references-carrousel-right-btn right-1 absolute size-8 cursor-pointer btn btn-circle btn-neutral"
        >❯</button
      >

      <script>
        const lBtn = document.querySelector('.references-carrousel-left-btn') as HTMLButtonElement
        const rBtn = document.querySelector('.references-carrousel-right-btn') as HTMLButtonElement
        const carrousel = document.querySelector('.references-carrousel') as HTMLDivElement

        lBtn.addEventListener('click', () => {
          carrousel.scrollBy(-carrousel.clientWidth, 0)
        })
        rBtn.addEventListener('click', () => {
          carrousel.scrollBy(carrousel.clientWidth, 0)
        })

        carrousel.addEventListener('scroll', () => {
          const atStart = carrousel.scrollLeft === 0
          const atEnd = carrousel.scrollLeft >= carrousel.scrollWidth - carrousel.clientWidth - 1

          if (atStart) {
            lBtn.classList.add('hidden')
          } else {
            lBtn.classList.remove('hidden')
          }

          if (atEnd) {
            rBtn.classList.add('hidden')
          } else {
            rBtn.classList.remove('hidden')
          }
        })
      </script>
    </div>
  </div>
</section>
